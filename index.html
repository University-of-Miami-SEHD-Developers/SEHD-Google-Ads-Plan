<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Google Ads Campaign Budget Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style for sticky header */
        .sticky-header th {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .sticky-col {
            position: sticky;
            left: 0;
            z-index: 5;
        }
        .sticky-col-2 {
            position: sticky;
            /* Adjust based on typical width of first column */
            left: 180px; 
            z-index: 5;
        }
        .percentage-total.error {
            color: #ef4444; /* red-500 */
            font-weight: bold;
        }
    </style>
     <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Dynamic Google Ads Budget Planner</h1>
            <p class="text-lg text-gray-600 mt-2">Adjust your campaign variables below to see the budget update in real-time.</p>
        </header>

        <!-- Dynamic Controls -->
        <div id="controls" class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-bold mb-4 border-b pb-2">Campaign Settings</h2>
            
            <!-- Global Settings -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div>
                    <label for="totalBudget" class="block text-sm font-medium text-gray-700">Total Budget ($)</label>
                    <input type="number" id="totalBudget" value="30000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="searchSplit" class="block text-sm font-medium text-gray-700">Search %</label>
                    <input type="range" id="searchSplit" min="0" max="100" value="80" class="mt-1 block w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    <span id="searchSplitValue" class="text-sm text-gray-500">80% Search / 20% Display</span>
                </div>
                 <div>
                    <label for="defaultStartDate" class="block text-sm font-medium text-gray-700">Default Start Date</label>
                    <input type="date" id="defaultStartDate" value="2025-09-29" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" disabled>
                </div>
            </div>

            <!-- Campaign Specific Settings -->
            <h3 class="text-xl font-semibold mb-4 mt-6 border-b pb-2">Campaign Allocation</h3>
            <div id="campaign-settings" class="grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-4">
                 <!-- Campaign inputs will be generated here -->
            </div>
            <div class="text-right mt-4 font-bold text-lg">
                <span >Total Allocated: </span>
                <span id="percentage-total">100%</span>
            </div>

        </div>

        <div class="bg-white shadow-lg rounded-lg overflow-x-auto">
            <table class="w-full text-sm text-left text-gray-500" id="budget-table">
                <thead class="text-xs text-gray-700 uppercase bg-gray-100 sticky-header"></thead>
                <tbody></tbody>
                <tfoot class="font-bold text-gray-800 bg-gray-200"></tfoot>
            </table>
        </div>
        <footer class="text-center mt-8 text-sm text-gray-500">
            <p>All figures are estimates. Actual daily spend may vary based on Google Ads performance.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const initialCampaigns = [
                { name: "Athletic Training", percentage: 60, startDate: "2025-09-29", endDate: "2025-10-31" },
                { name: "Counseling", percentage: 20, startDate: "2025-09-29", endDate: "2025-12-31" },
                { name: "Applied Physiology", percentage: 10, startDate: "2025-09-29", endDate: "2025-12-31" },
                { name: "EdD in Higher Education", percentage: 10, startDate: "2025-09-29", endDate: "2025-12-31" },
            ];

            const campaignSettingsContainer = document.getElementById('campaign-settings');
            initialCampaigns.forEach(c => {
                const div = document.createElement('div');
                div.classList.add('grid', 'grid-cols-1', 'sm:grid-cols-4', 'gap-4', 'p-3', 'bg-gray-50', 'rounded-md', 'items-center');
                div.innerHTML = `
                    <input type="text" value="${c.name}" class="sm:col-span-1 rounded-md border-gray-300 shadow-sm sm:text-sm campaign-name" placeholder="Campaign Name">
                    <div class="sm:col-span-1">
                        <div class="flex items-center">
                            <input type="number" value="${c.percentage}" min="0" max="100" class="w-20 rounded-md border-gray-300 shadow-sm sm:text-sm campaign-percentage" placeholder="%">
                            <span class="ml-1">%</span>
                        </div>
                    </div>
                    <div class="sm:col-span-1">
                         <input type="date" value="${c.startDate}" class="w-full rounded-md border-gray-300 shadow-sm sm:text-sm campaign-startDate">
                    </div>
                    <div class="sm:col-span-1">
                         <input type="date" value="${c.endDate}" class="w-full rounded-md border-gray-300 shadow-sm sm:text-sm campaign-endDate">
                    </div>
                `;
                campaignSettingsContainer.appendChild(div);
            });

            document.getElementById('controls').addEventListener('input', () => {
                updateSliderLabel();
                calculateAndRender();
            });
            
            function updateSliderLabel() {
                 const searchSplitInput = document.getElementById('searchSplit');
                 const searchSplitValue = document.getElementById('searchSplitValue');
                 const displaySplit = 100 - parseInt(searchSplitInput.value, 10);
                 searchSplitValue.textContent = `${searchSplitInput.value}% Search / ${displaySplit}% Display`;
            }

            function calculateAndRender() {
                // --- UTILITY FUNCTIONS ---
                const daysBetween = (date1, date2) => {
                    if (!date1 || !date2 || date1 > date2) return 0;
                    const oneDay = 24 * 60 * 60 * 1000;
                    return Math.round(Math.abs((date1 - date2) / oneDay)) + 1;
                };
                const getMonday = (d) => {
                    d = new Date(d);
                    const day = d.getDay();
                    const diff = d.getDate() - day + (day === 0 ? -6 : 1);
                    return new Date(d.setDate(diff));
                };
                const formatCurrency = (value) => value.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 });
                const formatDate = (date) => date.toISOString().split('T')[0];

                // --- 1. READ ALL UI VALUES AND DEFINE BUDGET POOLS ---
                const totalBudget = parseFloat(document.getElementById('totalBudget').value) || 0;
                const searchSplit = parseInt(document.getElementById('searchSplit').value, 10) / 100;
                const displaySplit = 1 - searchSplit;
                
                let totalPercentage = 0;
                const budgetPools = {};
                const campaignDivs = document.querySelectorAll('#campaign-settings > div');
                let overallStartDate = new Date('2999-12-31'); // Start with a future date
                let overallEndDate = new Date('1970-01-01'); // Start with a past date

                campaignDivs.forEach(div => {
                    const name = div.querySelector('.campaign-name').value;
                    const percentage = parseFloat(div.querySelector('.campaign-percentage').value) || 0;
                    const startDateStr = div.querySelector('.campaign-startDate').value;
                    const endDateStr = div.querySelector('.campaign-endDate').value;
                    if (!name || !startDateStr || !endDateStr) return;

                    const startDate = new Date(startDateStr + 'T12:00:00Z');
                    const endDate = new Date(endDateStr + 'T23:59:59Z');
                    totalPercentage += percentage;
                    
                    budgetPools[name] = {
                        budget: totalBudget * (percentage / 100),
                        startDate: startDate,
                        endDate: endDate
                    };
                    
                    if (startDate < overallStartDate) overallStartDate = startDate;
                    if (endDate > overallEndDate) overallEndDate = endDate;
                });
                
                if (isNaN(overallStartDate.getTime()) || isNaN(overallEndDate.getTime())) return;

                const percentageTotalEl = document.getElementById('percentage-total');
                percentageTotalEl.textContent = `${totalPercentage}%`;
                percentageTotalEl.classList.toggle('error', totalPercentage !== 100);

                // --- 2. GENERATE WEEKLY HEADERS ---
                const weeklyHeaders = [];
                let currentMonday = getMonday(overallStartDate);
                while (currentMonday <= overallEndDate) {
                    const weekStartDate = new Date(currentMonday);
                    const weekEndDate = new Date(currentMonday);
                    weekEndDate.setDate(weekEndDate.getDate() + 6);
                    weeklyHeaders.push({ key: formatDate(weekStartDate), start: weekStartDate, end: weekEndDate });
                    currentMonday.setDate(currentMonday.getDate() + 7);
                }

                // --- 3. CALCULATE AND DISTRIBUTE SPEND FROM POOLS ---
                const weeklyData = {};
                const uniqueCampaignNames = [...new Set(Object.keys(budgetPools))];

                uniqueCampaignNames.forEach(name => {
                    weeklyData[name] = { Search: {}, Display: {} };
                    weeklyHeaders.forEach(week => {
                        weeklyData[name].Search[week.key] = 0;
                        weeklyData[name].Display[week.key] = 0;
                    });
                });

                for (const poolName in budgetPools) {
                    const pool = budgetPools[poolName];
                    
                    if (poolName === "Athletic Training" && budgetPools["Counseling"]) {
                        const atStartDate = pool.startDate;
                        const atEndDate = pool.endDate;
                        const counselingEndDate = budgetPools["Counseling"].endDate;

                        const phase2StartDate = new Date(atEndDate);
                        phase2StartDate.setDate(phase2StartDate.getDate() + 1);
                        
                        const duration1 = daysBetween(atStartDate, atEndDate);
                        const duration2 = daysBetween(phase2StartDate, counselingEndDate);
                        const totalDurationForPool = duration1 + duration2;
                        
                        if (totalDurationForPool > 0) {
                             const dailySpendRate = pool.budget / totalDurationForPool;

                             weeklyHeaders.forEach(week => {
                                let activeDaysP1 = 0;
                                for (let d = new Date(week.start); d <= week.end; d.setDate(d.getDate() + 1)) {
                                    if (d >= atStartDate && d <= atEndDate) activeDaysP1++;
                                }
                                if (activeDaysP1 > 0) {
                                    const spend = dailySpendRate * activeDaysP1;
                                    weeklyData["Athletic Training"].Search[week.key] += spend * searchSplit;
                                    weeklyData["Athletic Training"].Display[week.key] += spend * displaySplit;
                                }

                                let activeDaysP2 = 0;
                                for (let d = new Date(week.start); d <= week.end; d.setDate(d.getDate() + 1)) {
                                     if (d >= phase2StartDate && d <= counselingEndDate) activeDaysP2++;
                                }
                                if (activeDaysP2 > 0) {
                                    const spend = dailySpendRate * activeDaysP2;
                                    weeklyData["Counseling"].Search[week.key] += spend * searchSplit;
                                    weeklyData["Counseling"].Display[week.key] += spend * displaySplit;
                                }
                            });
                        }
                    } else if (poolName !== "Counseling") {
                        const duration = daysBetween(pool.startDate, pool.endDate);
                        if (duration > 0) {
                            const dailySpendRate = pool.budget / duration;
                            weeklyHeaders.forEach(week => {
                                let activeDays = 0;
                                for (let d = new Date(week.start); d <= week.end; d.setDate(d.getDate() + 1)) {
                                    if (d >= pool.startDate && d <= pool.endDate) activeDays++;
                                }
                                if (activeDays > 0) {
                                    const spend = dailySpendRate * activeDays;
                                    weeklyData[poolName].Search[week.key] += spend * searchSplit;
                                    weeklyData[poolName].Display[week.key] += spend * displaySplit;
                                }
                            });
                        }
                    }
                }
                
                // Handle Counseling's own budget separately
                if (budgetPools["Counseling"]){
                    const counselingPool = budgetPools["Counseling"];
                    const duration = daysBetween(counselingPool.startDate, counselingPool.endDate);
                    if (duration > 0) {
                        const dailySpendRate = counselingPool.budget / duration;
                        weeklyHeaders.forEach(week => {
                            let activeDays = 0;
                            for (let d = new Date(week.start); d <= week.end; d.setDate(d.getDate() + 1)) {
                                if (d >= counselingPool.startDate && d <= counselingPool.endDate) activeDays++;
                            }
                            if (activeDays > 0) {
                                const spend = dailySpendRate * activeDays;
                                weeklyData["Counseling"].Search[week.key] += spend * searchSplit;
                                weeklyData["Counseling"].Display[week.key] += spend * displaySplit;
                            }
                        });
                    }
                }


                // --- 4. RENDER TABLE ---
                const tableHead = document.querySelector('#budget-table thead');
                const tableBody = document.querySelector('#budget-table tbody');
                const tableFoot = document.querySelector('#budget-table tfoot');

                let headerRow = '<tr>';
                headerRow += '<th scope="col" class="px-4 py-3 sticky-col bg-gray-100 min-w-[180px]">Campaign</th>';
                headerRow += '<th scope="col" class="px-4 py-3 sticky-col-2 bg-gray-100">Ad Type</th>';
                weeklyHeaders.forEach(week => headerRow += `<th scope="col" class="px-4 py-3 text-center">Week of<br>${week.start.toLocaleDateString()}</th>`);
                headerRow += '<th scope="col" class="px-4 py-3 font-bold bg-gray-200">Grand Total</th></tr>';
                tableHead.innerHTML = headerRow;

                let bodyHtml = '';
                const weeklyTotals = {};

                uniqueCampaignNames.forEach(name => {
                    ['Search', 'Display'].forEach((type, index) => {
                        bodyHtml += `<tr class="${index === 0 ? 'bg-white border-b' : 'bg-gray-50 border-b'}">`;
                        if (index === 0) bodyHtml += `<td rowspan="2" class="px-4 py-4 font-medium text-gray-900 whitespace-nowrap sticky-col bg-white border-b">${name}</td>`;
                        bodyHtml += `<td class="px-4 py-4 sticky-col-2 ${index === 0 ? 'bg-white' : 'bg-gray-50'}">${type}</td>`;
                        
                        let campaignTypeTotal = 0;
                        weeklyHeaders.forEach(week => {
                            const value = weeklyData[name]?.[type]?.[week.key] || 0;
                            campaignTypeTotal += value;
                            bodyHtml += `<td class="px-4 py-4 text-right">${formatCurrency(Math.round(value))}</td>`;
                            if(!weeklyTotals[week.key]) weeklyTotals[week.key] = 0;
                            weeklyTotals[week.key] += value;
                        });
                        
                        bodyHtml += `<td class="px-4 py-4 text-right font-semibold bg-gray-100">${formatCurrency(Math.round(campaignTypeTotal))}</td></tr>`;
                    });
                });
                tableBody.innerHTML = bodyHtml;

                let footerHtml = '<tr class="border-t-2 border-gray-400">';
                footerHtml += '<td colspan="2" class="px-4 py-4 font-bold text-lg">TOTALS</td>';
                weeklyHeaders.forEach(week => {
                    const total = weeklyTotals[week.key] || 0;
                    footerHtml += `<td class="px-4 py-4 text-right font-bold">${formatCurrency(Math.round(total))}</td>`;
                });
                
                const grandTotalFromWeeks = Object.values(weeklyTotals).reduce((sum, val) => sum + val, 0);
                footerHtml += `<td class="px-4 py-4 text-right font-bold text-lg">${formatCurrency(Math.round(grandTotalFromWeeks))}</td></tr>`;
                tableFoot.innerHTML = footerHtml;
            }

            // Initial Load
            updateSliderLabel();
            calculateAndRender();
        });
    </script>
</body>
</html>

